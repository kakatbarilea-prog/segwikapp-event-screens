<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Segwik AI – Event Screens (6-Scenarios)</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --ink:#243048; --muted:#667085; --line:#e6ebf2;
    --accent:#0F2D56; --btn:#1d305e; --pill:#eef4ff; --pill-border:#cfe1ff;
    --phone-w:430px; --phone-h:800px; --success:#0B8A4E; --danger:#b42318;
    --footer-h:76px; --status-h:46px; --head-h:52px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);
    font-family:'Segoe UI',system-ui,-apple-system,BlinkMacSystemFont,'Helvetica Neue',Arial,sans-serif}
  .wrap{display:flex;align-items:center;justify-content:center;min-height:100%;padding:18px}

  .phone{width:var(--phone-w);height:var(--phone-h);background:#fff;border-radius:36px;
    box-shadow:0 20px 60px rgba(0,0,0,.12),0 8px 16px rgba(0,0,0,.08);position:relative;
    overflow:hidden;border:8px solid #111;display:flex;flex-direction:column}
  .notch{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:180px;height:30px;background:#111;border-radius:20px 20px 28px 28px;z-index:10}
  .status{height:var(--status-h);padding:0 16px;display:flex;align-items:center;justify-content:center;gap:8px;border-bottom:1px solid var(--line);background:#fff;z-index:5}
  .status .logo{display:flex;align-items:center;gap:8px;font-weight:700;letter-spacing:.3px}
  .status .logo .bot{width:22px;height:22px;border-radius:50%;background:linear-gradient(145deg,#e9f0ff,#dfe9ff);display:grid;place-items:center;border:1px solid #c9d7ff}
  .status .logo .bot::before{content:"";width:10px;height:6px;border-radius:3px;display:block;background:#0F2D56;box-shadow:0 0 0 2px #b7ccff inset}

  .push-notice{
    position:absolute; top:var(--status-h); left:50%;
    transform:translateX(-50%) translateY(-120%); background:#0F2D56; color:#fff;
    padding:8px 14px; border-radius:12px; font-size:13px; font-weight:600; opacity:0;
    transition:transform .3s ease, opacity .3s ease; z-index:60;
    box-shadow:0 10px 24px rgba(0,0,0,.15); white-space:nowrap; max-width:calc(100% - 40px);
    overflow:hidden; text-overflow:ellipsis; display:flex; align-items:center; gap:10px;
  }
  .push-notice.show{transform:translateX(-50%) translateY(0); opacity:1;}
  .push-action{background:transparent; border:none; color:#fff; font-weight:800; cursor:pointer; text-decoration:underline; padding:0; margin:0;}

  /* CHANGED previously: removed extra scroll-padding-top to eliminate top gap on snap */
  .content{flex:1; overflow:auto; background:var(--bg); scroll-snap-type:y mandatory;}
  .screen{scroll-snap-align:start; padding-bottom:var(--footer-h); min-height:calc(100%); position:relative;}

  .page-head{position:sticky; top:0; z-index:4; background:#fff; border-bottom:1px solid var(--line)}
  .page-title{height:var(--head-h); padding:12px 16px 8px; display:flex; align-items:center; justify-content:space-between}
  .title-text{font-weight:800;color:var(--accent);font-size:18px}
  .count-pill{padding:6px 12px;border:1px solid var(--pill-border);background:var(--pill);border-radius:999px;font-size:12px;min-width:96px;text-align:center;color:#21314f;font-weight:700}

  .ev-card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;margin:12px;display:grid;gap:12px}
  .ev-hero{width:100%;aspect-ratio:16/9;border-radius:12px;background:#eaf0ff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width=\"600\" height=\"338\"><rect width=\"100%\" height=\"100%\" fill=\"%23eaf0ff\"/><text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\" font-family=\"Segoe UI\" font-size=\"22\" fill=\"%2390a7d9\">16:9 Featured Image</text></svg>') center/contain no-repeat;border:1px solid #cfe1ff}
  .ev-name{font-weight:800;font-size:16px}
  .ev-desc{font-size:13px;color:var(--muted);position:relative}
  .ev-desc.clamp{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  .ev-desc .more{color:#0F2D56;font-weight:700;cursor:pointer;white-space:nowrap}

  .row{display:flex;gap:8px;flex-wrap:wrap}
  .cta{padding:10px 12px;border-radius:10px;border:1px solid var(--btn);background:var(--btn);color:#fff;font-size:12px;cursor:pointer;text-align:center}
  .cta.ghost{background:#fff;color:#243048;border:1px solid #cbd5e1}
  .cta.success{background:var(--success);border-color:var(--success)}
  .cta.dropdown{position:relative; }
  .menu{position:absolute;top:100%;left:0;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.12);padding:6px;display:none;z-index:20}
  .menu.show{display:block}
  .menu button{display:block;width:180px;text-align:left;border:none;background:transparent;padding:8px;border-radius:8px;font-size:12px;cursor:pointer}
  .menu button:hover{background:#f3f6ff}

  .tray{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;padding:8px;border-top:1px solid var(--line);background:#fff;position:sticky;bottom:0}
  .ibtn{padding:8px;border:1px solid var(--line);border-radius:10px;background:#f8fafc;display:grid;place-items:center;font-size:11px;cursor:pointer}
  .ibtn svg{width:17px;height:17px}
  svg{stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}

  .overlay{position:absolute;inset:0;background:rgba(15,45,86,.25);display:none;align-items:flex-end;z-index:50}
  .overlay.show{display:flex}
  .sheet{width:min(560px,92vw);background:#fff;border:1px solid var(--pill-border);
    border-radius:18px 18px 0 0;box-shadow:0 18px 40px rgba(15,45,86,.18);padding:14px;transform:translateY(100%);transition:transform .25s ease}
  .overlay.show .sheet{transform:translateY(0)}
  .sheet-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .sheet-title{font-weight:800;color:#0F2D56}
  .x{width:28px;height:28px;border-radius:8px;border:1px solid var(--pill-border);background:#eef4ff;display:grid;place-items:center;cursor:pointer}
  .sheet .small{font-size:12px;color:#475569}
  .sheet p{margin:0 0 8px 0}

  .attendees{display:grid;gap:8px;max-height:52vh;overflow:auto}
  .a-card{border:1px solid #e6ebf2;border-radius:10px;padding:10px;display:grid;gap:6px}
  .a-top{display:flex;gap:10px;align-items:center}
  .ava{width:40px;height:40px;border-radius:50%;background:#dbe4ff;display:grid;place-items:center;font-weight:700;color:#0F2D56;border:1px solid #c8d4ff;font-size:14px;overflow:hidden}
  .ava img{width:100%;height:100%;object-fit:cover;border-radius:50%}
  .a-name{font-weight:700}
  .a-role{font-size:12px;color:#667085}
  .a-chips{display:flex;gap:6px;flex-wrap:wrap}
  .chip{font-size:11px;color:#4a5568;background:#f1f5f9;padding:2px 6px;border-radius:999px;border:1px solid #e2e8f0}
  .a-actions{display:flex;gap:6px;flex-wrap:wrap}
  .btn-sm{padding:8px 10px;border-radius:10px;border:1px solid #cbd5e1;background:#fff;color:#243048;font-size:12px;cursor:pointer}
  .btn-sm.primary{border:1px solid var(--btn);background:var(--btn);color:#fff}
  .btn-sm.success{background:var(--success);border-color:var(--success);color:#fff}
  .btn-sm.dropdown{position:relative}
  .btn-sm .menu{min-width:220px}

  .row-btns{margin-top:8px;display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
  .i-btn{padding:10px 12px;border-radius:10px;border:1px solid var(--pill-border);background:#eef4ff;font-size:12px;cursor:pointer}
  .i-btn.primary{border:1px solid var(--btn);background:var(--btn);color:#fff;font-weight:700}

  textarea{resize:vertical;}
  .sheet textarea{width:100%;min-height:120px;border:1px solid #d3def0;border-radius:10px;padding:8px;font-size:13px}
  .sheet .field{display:grid;gap:6px;margin:8px 0}
  .sheet input, .sheet select{width:100%;border:1px solid #d3def0;border-radius:10px;padding:8px;font-size:13px}

  #prepOverlay .sheet textarea{min-height:240px;}
  #commOverlay .sheet textarea{min-height:240px;}

  /* NEW: link-like button for See More placed outside clamped text */
  .linkish{background:transparent;border:none;color:#0F2D56;font-weight:700;cursor:pointer;padding:0;margin:0;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="phone" role="application" aria-label="Segwik Events">
    <div class="notch"></div>
    <div class="status">
      <div class="logo"><span class="bot"></span><span>SEGWiK</span></div>
    </div>

    <div id="push" class="push-notice"></div>

    <div class="content" id="content">

      <!-- 1) Upcoming Event – Not Registered -->
      <section class="screen" id="scr-1">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Upcoming Event</div>
            <span class="count-pill" id="badge-1">Not Registered</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">Local Chamber Breakfast</div>
          <div class="ev-desc clamp" id="desc-2">
            A high-tempo referral meeting with measurable introductions, a featured talk, and time-boxed 1-to-1 scheduling.
            <span class="more" onclick="openLong('BNI Rock Solid — Details', lorem)">…See More</span>
          </div>
          <div class="row">
            <button class="cta" id="reg-1" onclick="register('1')">Register</button>
            <button class="cta ghost" onclick="openPeople('who-1','Who’s Going', attendeesA, {bulk:true})">See Who’s Going (12)</button>
            <div class="cta ghost dropdown" onclick="toggleMenu(event)">
              Share Event
              <div class="menu">
                <button onclick="share('LinkedIn')">Share on LinkedIn</button>
                <button onclick="share('Facebook')">Share on Facebook</button>
                <button onclick="share('Instagram')">Share on Instagram</button>
              </div>
            </div>
            <button class="cta ghost" onclick="notNow('scr-1')">Not Now</button>
          </div>
        </div>
      </section>

      <!-- 2) Upcoming Event – Registered -->
      <section class="screen" id="scr-2">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Upcoming Event</div>
            <span class="count-pill" id="badge-2">Registered</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">BNI Rock Solid (Weekly)</div>
          <div class="ev-desc clamp" id="desc-2">
            A high-tempo referral meeting with measurable introductions, a featured talk, and time-boxed 1-to-1 scheduling.
            <span class="more" onclick="openLong('BNI Rock Solid — Details', lorem)">…See More</span>
          </div>
          <div class="row" id="row-2">
            <!-- Post-register state -->
            <button class="cta ghost" onclick="openPeople('who-2','Who’s Going', attendeesB, {bulk:true})">See Who’s Going (24)</button>
            <div class="cta ghost dropdown" onclick="toggleMenu(event)">
              Share Event
              <div class="menu">
                <button onclick="share('LinkedIn')">Share on LinkedIn</button>
                <button onclick="share('Facebook')">Share on Facebook</button>
                <button onclick="share('Instagram')">Share on Instagram</button>
              </div>
            </div>
            <button class="cta" onclick="openPrep('BNI Rock Solid — Prep Notes')">Prep for Event</button>
          </div>
        </div>
      </section>

      <!-- 3) Ongoing – Not Checked In -->
      <section class="screen" id="scr-3">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Ongoing Event</div>
            <span class="count-pill" id="badge-3">Not Checked In</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">Startup Mixer</div>
          <div class="ev-desc clamp" id="desc-3">
            Casual networking with founder lightning talks, demo corners, and investor office hours.
            <span class="more" onclick="openLong('Startup Mixer — Agenda', loremAgenda)">…See More</span>
          </div>
          <div class="row" id="row-3">
            <button class="cta" onclick="checkIn('3')">Check In</button>
            <button class="cta ghost" onclick="openPeople('who-3','Who’s Here Now', attendeesC, {bulk:true})">See Who’s Here (15)</button>
            <button class="cta" onclick="openPrep('Startup Mixer — Prep Notes')">View Prep Notes</button>
            <button class="cta ghost" onclick="openLong('Agenda', loremAgenda)">View Agenda</button>
            <button class="cta ghost" onclick="openPeople('spk-3','Speakers', speakers, {bulk:false})">View Speakers</button>
            <button class="cta ghost" onclick="takeSelfie()">Take Selfies</button>
            <div class="cta ghost dropdown" onclick="toggleMenu(event)">
              Share Event
              <div class="menu">
                <button onclick="share('LinkedIn')">Share on LinkedIn</button>
                <button onclick="share('Facebook')">Share on Facebook</button>
                <button onclick="share('Instagram')">Share on Instagram</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 4) Ongoing – Checked-in -->
      <section class="screen" id="scr-4">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Ongoing Event</div>
            <span class="count-pill" id="badge-4">Checked-in</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">Design & UX Summit</div>
          <div class="ev-desc clamp" id="desc-4">
            Deep-dive sessions on product design, research, and design systems with live critiques.
            <span class="more" onclick="openLong('Design & UX Summit — Details', lorem)">…See More</span>
          </div>
          <div class="row" id="row-4">
            <!-- Post-checkin state -->
            <button class="cta ghost" onclick="openPeople('who-4','Who’s Here Now', attendeesD, {bulk:true})">See Who’s Here (42)</button>
            <button class="cta" onclick="openPrep('Design & UX Summit — Prep Notes')">View Prep Notes</button>
            <button class="cta ghost" onclick="openLong('Agenda', loremAgenda)">View Agenda</button>
            <button class="cta ghost" onclick="openPeople('spk-4','Speakers', speakers, {bulk:false})">View Speakers</button>
            <button class="cta ghost" onclick="takeSelfie()">Take Selfies</button>
            <div class="cta ghost dropdown" onclick="toggleMenu(event)">
              Share Event
              <div class="menu">
                <button onclick="share('LinkedIn')">Share on LinkedIn</button>
                <button onclick="share('Facebook')">Share on Facebook</button>
                <button onclick="share('Instagram')">Share on Instagram</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 5) Past – Attended -->
      <section class="screen" id="scr-5">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Past Event</div>
            <span class="count-pill" id="badge-5">Attended</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">Chamber Mixer (Downtown)</div>
          <div class="ev-desc clamp" id="desc-5">
            Open-format mixer with sponsor tables and a capital-access panel.
            <span class="more" onclick="openLong('Chamber Mixer — Recap', lorem)">…See More</span>
          </div>
          <div class="row">
            <button class="cta ghost" onclick="openPeople('who-5','Attendees', attendeesE, {bulk:true})">View Attendees (58)</button>
            <button class="cta" onclick="openPrep('Add Takeaways — Chamber Mixer', true)">Add Takeaways</button>
            <div class="cta ghost dropdown" onclick="toggleMenu(event)">
              Share Event
              <div class="menu">
                <button onclick="share('LinkedIn')">Share on LinkedIn</button>
                <button onclick="share('Facebook')">Share on Facebook</button>
                <button onclick="share('Instagram')">Share on Instagram</button>
              </div>
            </div>
            <button class="cta ghost" id="rem-like-5" onclick="toggleLike('rem-like-5','You’ll get reminders for similar events.')">Remind Me About Future Events Like This</button>
          </div>
        </div>
      </section>

      <!-- 6) Past – Did Not Attend -->
      <section class="screen" id="scr-6">
        <div class="page-head">
          <div class="page-title">
            <div class="title-text">Past Event</div>
            <span class="count-pill" id="badge-6">Did Not Attend</span>
          </div>
        </div>
        <div class="ev-card">
          <div class="ev-hero"></div>
          <div class="ev-name">Small Business Expo</div>
          <div class="ev-desc clamp" id="desc-6">
            Vendor hall, learning tracks, and pitch lounge for SMB owners and operators.
            <span class="more" onclick="openLong('Small Business Expo — Recap', lorem)">…See More</span>
          </div>
          <div class="row">
            <button class="cta ghost" onclick="openPeople('who-6','Attendees', attendeesF, {bulk:true})">View Attendees (103)</button>
            <button class="cta ghost" id="alerts-6" onclick="toggleLike('alerts-6','You’ll get alerts for similar events.')">Get Alerts for Similar Events</button>
          </div>
        </div>
      </section>

    </div>

    <div class="tray" id="footer-tray">
      <div class="ibtn" data-icon="phone"></div>
      <div class="ibtn" data-icon="mail"></div>
      <div class="ibtn" data-icon="chat"></div>
      <div class="ibtn" data-icon="calendar"></div>
      <div class="ibtn" data-icon="note"></div>
    </div>

    <!-- Long Description / Agenda -->
    <div id="detailsOverlay" class="overlay" onclick="overlayClose(event,'detailsOverlay')" role="dialog" aria-modal="true">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-head">
          <div class="sheet-title" id="detailsTitle">Details</div>
          <div class="x" onclick="closeSheet('detailsOverlay')">×</div>
        </div>
        <div id="detailsBody" class="small"></div>
        <div class="row-btns">
          <button class="i-btn" onclick="closeSheet('detailsOverlay')">Close</button>
        </div>
      </div>
    </div>

    <!-- People / Attendees / Speakers (with Bulk Actions) -->
    <div id="attOverlay" class="overlay" onclick="overlayClose(event,'attOverlay')" role="dialog" aria-modal="true">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-head">
          <div class="sheet-title" id="attTitle">People</div>
          <div class="x" onclick="closeSheet('attOverlay')">×</div>
        </div>
        <div id="attBody" class="attendees"></div>
        <div id="bulkRow" class="row-btns" style="display:none;">
          <button class="i-btn" onclick="bulkEmail()">Email All</button>
          <button class="i-btn" onclick="bulkText()">Text All</button>
          <button class="i-btn primary" onclick="bulkJourney()">Add All to Journey</button>
        </div>
      </div>
    </div>

    <!-- Prep / Takeaways -->
    <div id="prepOverlay" class="overlay" onclick="overlayClose(event,'prepOverlay')" role="dialog" aria-modal="true">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-head">
          <div class="sheet-title" id="prepTitle">Prep Notes</div>
          <div class="x" onclick="closeSheet('prepOverlay')">×</div>
        </div>
        <textarea id="prepMsg"></textarea>
        <div class="row-btns">
          <button class="i-btn" onclick="closeSheet('prepOverlay')">Close</button>
          <button class="i-btn primary" onclick="savePrep()">Save</button>
        </div>
      </div>
    </div>

    <!-- Compose (Email/Text/Call) -->
    <div id="commOverlay" class="overlay" onclick="overlayClose(event,'commOverlay')" role="dialog" aria-modal="true">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-head">
          <div class="sheet-title" id="commTitle">Compose</div>
          <div class="x" onclick="closeSheet('commOverlay')">×</div>
        </div>
        <div class="field">
          <label class="small">To</label>
          <input id="commTo" type="text" readonly />
          <div id="commError" class="small" style="color:var(--danger);display:none;"></div>
        </div>
        <div class="field">
          <label class="small">Channel</label>
          <select id="commChannel" onchange="onCommChannelChange()">
            <option value="email">Email</option>
            <option value="text">Text</option>
            <option value="call">Call</option>
          </select>
        </div>
        <div class="field" id="commMsgWrap">
          <label class="small">Message</label>
          <textarea id="commMsg"></textarea>
        </div>
        <div class="row-btns">
          <button class="i-btn" onclick="closeSheet('commOverlay')">Cancel</button>
          <button class="i-btn primary" id="commSendBtn" onclick="sendComm()">Send</button>
        </div>
      </div>
    </div>

    <!-- Add Note (per person) -->
    <div id="noteOverlay" class="overlay" onclick="overlayClose(event,'noteOverlay')" role="dialog" aria-modal="true">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-head">
          <div class="sheet-title" id="noteTitle">Add Note</div>
          <div class="x" onclick="closeSheet('noteOverlay')">×</div>
        </div>
        <textarea id="noteMsg" placeholder="Jot a quick note…"></textarea>
        <div class="row-btns">
          <button class="i-btn" onclick="closeSheet('noteOverlay')">Cancel</button>
          <button class="i-btn primary" onclick="saveNote()">Save Note</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Hidden input for camera/selfie capture -->
<input id="selfieInput" type="file" accept="image/*" capture="environment" style="display:none" />

<script>
/* ---------- Mock Long Text ---------- */
const lorem = `
<p><strong>What to Expect</strong></p>
<p>A structured flow with intros, sponsor spotlight, and breakout tables designed to surface referral opportunities.</p>
<p>Bring 30–40 business cards and be ready with a tight 20-second “specific ask.” Doors open 15 minutes early for coffee and informal chat.</p>
<p><em>Parking:</em> Municipal garage across the street. <em>Dress:</em> Business casual.</p>`;
const loremAgenda = `
<p><strong>Agenda</strong></p>
<ul>
  <li>7:00–7:10 Check-in & Coffee</li>
  <li>7:10–7:30 Lightning Intros</li>
  <li>7:30–7:50 Sponsor Talk + Q&A</li>
  <li>7:50–8:15 Breakouts / 1-to-1 Scheduling</li>
  <li>8:15–8:30 Open Networking</li>
</ul>`;

/* ---------- Mock People ---------- */
function P(id, name, title, company, email, phone, saved=false, pic=null){
  return {id, name, title, company, email, phone, saved, pic};
}
const attendeesA = [
  P('a1','Liam Carter','Mortgage Advisor','Carter Lending','liam@carterlending.com','+18485550101',true),
  P('a2','Grace Lee','Photographer','Grace Shots','grace@graceshots.studio','+12015550164',true),
  P('a3','Ethan Patel','CPA','Patel Accounting','ethan@patelaccounting.com','+18565550177',true),
  P('a4','Priya Menon','Physical Therapist','Shore PT','priya@shorept.health','+16095550145',false),
];
const attendeesB = [
  P('b1','Daniel Ortiz','Demand Gen Lead','Pipelane','daniel@pipelane.io','+18485550179',true),
  P('b2','Isabella Rossi','Marketing Manager','Rossi Marketing','isabella@rossimktg.com','+17325550191',false),
  P('b3','Derek O’Neil','Plumber','FlowPro','','+16095550193',false),
  P('b4','Leah Kim','Product Designer','Sketchly','leah@sketchly.design','',true),
];
const attendeesC = [
  P('c1','Chris Bell','VP Sales','NeonPeak','chris@neonpeak.io','+17325550122',true),
  P('c2','Rita Mendez','Founder','MendWell','rita@mendwell.co','+17325550111',true),
  P('c3','Hiroko Kato','Ops Lead','RiverNine','hiroko@rivernine.com','',false),
];
const attendeesD = [
  P('d1','Kathy Lin','Accountant','Lin & Co','kathy@linco.tax','+17325550155',true),
  P('d2','Paul Diaz','Project Manager','BuildRight','paul@buildright.pro','+17325550188',false),
  P('d3','Sara Torres','Owner','Craft&Co','sara@craftnco.com','+17325550112',true),
];
const attendeesE = [
  P('e1','Ava Brooks','Sales Director','Northline','ava@northline.app','+19085550186',true),
  P('e2','Noah Smith','Software Engineer','CodeCo','noah@codeco.dev','+19735550152',false),
  P('e3','Sophia Gomez','Event Planner','Gomez Events','sophia@gomezevents.co','+17325550112',true),
];
const attendeesF = [
  P('f1','Raj Khanna','CFO','Triventa','raj@triventa.com','',true),
  P('f2','Vera Grant','Operations Manager','GrantWorks','vera@grantworks.co','',false),
  P('f3','Luis Cortez','Insurance Broker','Cortez Coverage','luis@cortezcoverage.com','+17325550133',false),
];
const speakers = [
  P('s1','Dr. Nina Park','Keynote','Nexus Health','nina@nexus.health','',true),
  P('s2','Owen Moss','Marketing Director','FWD Labs','owen@fwdlabs.io','+17325550144',true),
];

/* ---------- State ---------- */
const draftsById = {};  // keep last-typed messages per channel
let commTarget = null;  // {type, person, email, phone}
let noteTarget = null;  // person
const selfieInput = document.getElementById('selfieInput');

/* ---------- Footer icons ---------- */
function icon(name){
  switch(name){
    case 'mail': return `<svg viewBox="0 0 24 24"><path d="M4 6h16v12H4z"/><path d="M4 7l8 6 8-6"/></svg>`;
    case 'phone': return `<svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0  0 1 4.11 2h3a2 2 0  0 1 2 1.72c.12.9.3 1.77.57 2.61a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0  0  0 6 6l1.47-1.11a2 2 0 0 1 2.11-.45c.84.27 1.71.45 2.61.57A2 2 0 0 1 22 16.92z"/></svg>`;
    case 'chat': return `<svg viewBox="0 0 24 24"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>`;
    case 'calendar': return `<svg viewBox="0 0 24 24"><path d="M3 8h18M5 4h14v16H5z"/><path d="M16 2v4M8 2v4"/></svg>`;
    case 'note': return `<svg viewBox="0 0 24 24"><path d="M4 3h14l2 2v16H4z"/><path d="M9 13h6M9 9h6M9 17h3"/></svg>`;
  }
}
document.querySelectorAll('#footer-tray [data-icon]').forEach(el=>{
  el.innerHTML = icon(el.getAttribute('data-icon')) || '';
});

/* ---------- Menus / Overlays / Toasts ---------- */
function toggleMenu(e){
  const dd = e.currentTarget.querySelector('.menu');
  const open = dd.classList.contains('show');
  document.querySelectorAll('.menu').forEach(m=>m.classList.remove('show'));
  if(!open) dd.classList.add('show');
  e.stopPropagation();
}
document.addEventListener('click', ()=>document.querySelectorAll('.menu').forEach(m=>m.classList.remove('show')));

function showSheet(id){ document.getElementById(id).classList.add('show'); }
function closeSheet(id){ document.getElementById(id).classList.remove('show'); }
function overlayClose(e,id){ if(e.target.id===id) closeSheet(id); }

function showPush(text){
  const el = document.getElementById('push');
  el.textContent = text;
  el.classList.add('show');
  clearTimeout(showPush._t);
  showPush._t = setTimeout(()=>el.classList.remove('show'), 2200);
}

/* ---------- Long text / Agenda ---------- */
function openLong(title, html){
  document.getElementById('detailsTitle').textContent = title;
  document.getElementById('detailsBody').innerHTML = html;
  showSheet('detailsOverlay');
}

/* ---------- Register / Check-in / Alerts ---------- */
function register(id){
  document.getElementById('badge-1').textContent = 'Registered';
  const btn = document.getElementById('reg-1');
  if(btn){
    // remove "Register" and "Not Now"
    btn.remove();
    const row = btn.parentElement;
    const notNowBtn = Array.from(row.children).find(b => b.textContent.trim() === 'Not Now');
    if(notNowBtn) notNowBtn.remove();
    // add "Prep for Event" to match Screen 2
    const prepBtn = document.createElement('button');
    prepBtn.className = 'cta';
    prepBtn.textContent = 'Prep for Event';
    prepBtn.onclick = ()=>openPrep('Local Chamber Breakfast — Prep Notes');
    row.appendChild(prepBtn);
    showPush('You are registered.');
  }
}
function checkIn(id){
  document.getElementById('badge-3').textContent = 'Checked-in';
  const row = document.getElementById('row-3');
  if(row){
    row.querySelector('button').remove(); // remove "Check In"
    showPush('Checked in.');
  }
}
function toggleLike(btnId, msg){
  const b = document.getElementById(btnId);
  b.classList.add('success'); b.classList.remove('ghost');
  b.textContent = 'Enabled ✓';
  showPush(msg);
}

/* Not Now removes the screen and scrolls to the next */
function notNow(sectionId){
  const sec = document.getElementById(sectionId);
  if(!sec) return;
  const next = sec.nextElementSibling;
  sec.remove();
  if(next && next.scrollIntoView){
    next.scrollIntoView({behavior:'smooth', block:'start'});
  }
  showPush('Event dismissed.');
}

/* ---------- Prep / Takeaways ---------- */
function openPrep(title, isTakeaways=false){
  document.getElementById('prepTitle').textContent = title;
  const t = document.getElementById('prepMsg');
  t.value = isTakeaways
    ? `Top takeaways:\n• \n• \n• \n\nPeople to introduce:\n• \n\nNext steps:\n• `
    : `Prep checklist:\n• Who do I want to meet?\n• My quick ask (20s):\n• 1–2 case studies to mention:\n• Follow-up promise:\n\nNotes:\n• `;
  showSheet('prepOverlay');
}
function savePrep(){ closeSheet('prepOverlay'); showPush('Saved.'); }

/* ---------- Share ---------- */
function share(where){ showPush(`Sharing to ${where}…`); }

/* ---------- Selfies / Camera ---------- */
function takeSelfie(){
  selfieInput.onchange = ()=>{
    if(selfieInput.files && selfieInput.files[0]){
      showPush('Selfie saved to this event.');
    }
  };
  selfieInput.click();
}

/* ---------- People Lists ---------- */
function openPeople(key, title, list, {bulk}){
  document.getElementById('attTitle').textContent = title;
  document.getElementById('bulkRow').style.display = bulk ? 'flex' : 'none';
  const body = document.getElementById('attBody');
  body.innerHTML = list.map(personCard).join('');
  showSheet('attOverlay');
}
function initialsOf(name){
  return name.split(' ').map(p=>p[0]).slice(0,2).join('').toUpperCase();
}
function personCard(p){
  const saveBtn = p.saved ? '' : `<button class="btn-sm primary" onclick="saveContact('${p.id}', this)">Save Contact</button>`;
  /* CHANGED: Add to Journey trigger is a button-styled span with a proper absolutely-positioned dropdown (only two options) */
  const addJourney = `
    <span class="btn-sm dropdown" role="button" tabindex="0" onclick="toggleMenu(event)">
      Add to Journey
      <div class="menu">
        <button onclick="addToJourney('${p.id}','1-on-1 Meeting Request')">1-on-1 Meeting Request</button>
        <button onclick="addToJourney('${p.id}','Nurturing Journey')">Nurturing Journey</button>
      </div>
    </span>`;
  return `
  <div class="a-card">
    <div class="a-top">
      <div class="ava">${p.pic?`<img src="${p.pic}" alt="${p.name}">`:initialsOf(p.name)}</div>
      <div style="flex:1">
        <div class="a-name">${p.name}</div>
        <div class="a-role">${p.title || ''}${p.company?` @ ${p.company}`:''}</div>
      </div>
    </div>
    <div class="a-actions">
      ${saveBtn}
      <button class="btn-sm" ${p.email?'':'disabled'} onclick="openComm('email',${encodeURIComponent(JSON.stringify(p)).replace(/"/g,'&quot;')})">Send Email</button>
      <button class="btn-sm" ${p.phone?'':'disabled'} onclick="openComm('text',${encodeURIComponent(JSON.stringify(p)).replace(/"/g,'&quot;')})">Send Text</button>
      <button class="btn-sm" ${p.phone?'':'disabled'} onclick="openComm('call',${encodeURIComponent(JSON.stringify(p)).replace(/"/g,'&quot;')})">Call</button>
      <button class="btn-sm" onclick="openNote(${encodeURIComponent(JSON.stringify(p)).replace(/"/g,'&quot;')})">Add a Note</button>
      ${addJourney}
      <button class="btn-sm" onclick="remindPerson('${p.id}')">Remind Me</button>
    </div>
  </div>`;
}
function saveContact(id, btn){
  btn.textContent='Contact Saved';
  btn.classList.remove('primary');
  btn.classList.add('success');
  btn.disabled = true;
  showPush('Contact saved.');
}
function remindPerson(id){ showPush('Reminder set.'); }

/* ---------- Bulk Actions ---------- */
function bulkEmail(){ showPush('Email blast queued to all.'); }
function bulkText(){ showPush('Text blast queued to all.'); }
function bulkJourney(){ showPush('All added to selected journey.'); }

/* ---------- Notes ---------- */
function openNote(p){
  noteTarget = p;
  document.getElementById('noteTitle').textContent = `Add Note — ${p.name}`;
  document.getElementById('noteMsg').value = '';
  showSheet('noteOverlay');
}
function saveNote(){
  closeSheet('noteOverlay');
  showPush('Note saved.');
}

/* ---------- Journeys ---------- */
function addToJourney(id, journey){
  showPush(`Added to “${journey}”.`);
}

/* ---------- Compose (Email/Text/Call) ---------- */
function openComm(type, p){
  const email = p.email || '';
  const phone = (p.phone||'').replace(/[^+\d]/g,'');
  commTarget = {type, person:p, email, phone};

  document.getElementById('commTitle').textContent = `Compose — ${capitalize(type)}`;
  document.getElementById('commChannel').value = type;

  // Restore any draft
  const key = `${p.id}:${type}`;
  const msg = draftsById[key] || defaultMessage(type, p);

  setCommToAndUI(type, p.name, email, phone, msg);
  showSheet('commOverlay');
}
function onCommChannelChange(){
  if(!commTarget) return;
  const channel = document.getElementById('commChannel').value;
  // store last draft of old type
  const oldKey = `${commTarget.person.id}:${commTarget.type}`;
  const curMsg = document.getElementById('commMsg').value;
  if(curMsg) draftsById[oldKey] = curMsg;

  commTarget.type = channel;
  const newKey = `${commTarget.person.id}:${channel}`;
  const msg = draftsById[newKey] || defaultMessage(channel, commTarget.person);
  setCommToAndUI(channel, commTarget.person.name, commTarget.email, commTarget.phone, msg);
}
function setCommToAndUI(type, name, email, phone, msg){
  const toEl = document.getElementById('commTo');
  const wrap = document.getElementById('commMsgWrap');
  const sendBtn = document.getElementById('commSendBtn');
  const msgEl = document.getElementById('commMsg');
  const err = document.getElementById('commError');

  err.style.display='none';

  if(type==='email'){
    toEl.value = `${name} • ${email||'no email'}`;
    wrap.style.display='grid';
    msgEl.value = msg;
    sendBtn.disabled = !email;
    if(!email){ err.textContent='No email on file.'; err.style.display='block'; }
  } else if(type==='text'){
    toEl.value = `${name} • ${phone||'no number'}`;
    wrap.style.display='grid';
    msgEl.value = msg;
    sendBtn.disabled = !phone;
    if(!phone){ err.textContent='No mobile number on file.'; err.style.display='block'; }
  } else { // call
    toEl.value = `${name} • ${phone||'no number'}`;
    wrap.style.display='none';
    sendBtn.disabled = !phone;
    if(!phone){ err.textContent='No phone number on file.'; err.style.display='block'; }
  }
}
function sendComm(){
  if(!commTarget) return;
  const channel = document.getElementById('commChannel').value;
  if(channel!=='call'){
    const key = `${commTarget.person.id}:${channel}`;
    draftsById[key] = document.getElementById('commMsg').value || '';
  }
  closeSheet('commOverlay');
  const who = commTarget.person.name;
  if(channel==='call'){
    showPush(`Calling ${who} at ${commTarget.phone}…`);
  } else if(channel==='email'){
    showPush(`Email sent to ${who} at ${commTarget.email}.`);
  } else {
    showPush(`Text sent to ${who} at ${commTarget.phone}.`);
  }
  commTarget = null;
}
function defaultMessage(type, p){
  const first = String(p.name||'').split(' ')[0]||p.name;
  if(type==='text'){
    return `${first}, great connecting around the event. Open to a quick 15–20 min chat next week to trade notes? — [from_firstname]`;
  }
  return `Hi ${first},

Enjoyed connecting around the event. I jotted a couple ideas that could be helpful—would you be open to a quick 15–20 minute chat next week?

Best,
[from_firstname] [from_lastname]`;
}
function capitalize(s){ return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

/* ---------- Utility ---------- */
function safeText(s){ return String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
</script>
</body>
</html>
